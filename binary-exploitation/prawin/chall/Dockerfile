FROM debian:stable-slim

RUN apt-get update && apt-get install -y socat
RUN useradd -m ctf
RUN mkdir /home/ctf/chall

COPY flag.txt /home/ctf/
COPY chall /home/ctf/chall/

RUN chown root:root /home/ctf/flag.txt && chmod 444 /home/ctf/flag.txt
RUN chown -R ctf:ctf /home/ctf/chall && chmod +x /home/ctf/chall/chall

USER ctf
CMD socat TCP-LISTEN:1801,reuseaddr,fork EXEC:/home/ctf/chall/chall