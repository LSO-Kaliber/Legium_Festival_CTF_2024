from sage.all import *
from Crypto.Util.number import *

m1=70583652316319345235581485149295122439299140964403754169033599410660477055283012438244384343098120785906182064250656350995185895030708856843060837097424586372245986523299877234471207759848186973437150644503082596435899156131131177620297445201355058679130932792923775338868784615214418080187698708350131595197
m2=99774973989322346679116783666654286020929414603651473139661518958465132771784156899928644879980813068002088238742878889531987930535907958308519172690063292520412477751233689621798243805947391270916703222815654794660063856329990530670150852856262523101635473372814825241057693192160122295694914642719380763230
n1=0x71b94030b43e3eff58306cf2fc22f69137265392eb105cf9a040fce948f932f6bf1265cca74745a7618e30a034e3d25743baa4e30dd84afdb3d25be46bc41e02704574fdc7d3121f325927b4e9521e7f976c26fee2d8f08480fcb0b555e368d1448948680ceaf770faec002f517e9d95a71b07ff2dc2c81b16d2c00c918bcee1
n2=170374499486306385639350956451230852362212411742527513061967319793459200812626101197736916910633079153608488939729087479909774170336579128104210728506650374147814485501467404180674639821581357957989208931016558056552110531124415942872290866029447536954737325212411294264736049899385224554599049353833171510692
p="95441735a85430b4e9d0fc6711d5a8e9415?????????f86ab6468ca8fbd3e3159b?????????f2bc8bf95e43e6a383463c5e1472a3037e84???????10d7cdfe85"

# https://github.com/jvdsn/crypto-attacks/blob/master/attacks/factorization/coppersmith.py
import sys
import os
path = os.path.dirname(os.path.dirname(os.path.dirname(
    os.path.realpath(os.path.abspath(__file__)))))
if sys.path[1] != path:
    sys.path.insert(1, path)
from crypto_attacks.shared.partial_integer import PartialInteger
from crypto_attacks.attacks.factorization.coppersmith import factorize_p

p = PartialInteger.parse_be(p, 16)
p, q = factorize_p(n1, p, m=6, t=2)
print(f"{p = }")
print(f"{q = }")

n1 = p * q
phi = (p - 1) * (q - 1)
d1 = inverse(65537, phi)
print(long_to_bytes(pow(m1, d1, n1)))

n2 = n2 + p
phi = n2 - 1
d2 = inverse(65537, phi)
print(long_to_bytes(pow(m2, d2, n2)))