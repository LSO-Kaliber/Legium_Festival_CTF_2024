<?php

$secret = "D3f4agUEBsQDD3R5vCZRmIMALUMqh0Rw";
$flag = "LEST2024{0ld_vUln3rab1liTtY_in_php_7_jUzt_f0r_1nF0rm4t10on}";

if ($_SERVER['REQUEST_METHOD'] === 'GET') {
    echo "hello i am web server\n";

} else if ($_SERVER['REQUEST_METHOD'] === 'POST') {

    if (empty($_POST['hmac']) || empty($_POST['host'])){
        echo 'HTTP/1.0 400 Bad Request';
        exit;
    }

    if (isset($_POST['nonce'])){
        $secret = hash_hmac('sha256', $_POST['nonce'], $secret);
    }

    $hmac = hash_hmac('sha256', $_POST['host'], $secret);

    if ($hmac !== $_POST['hmac']){
        header('HTTP/1.0 403 Forbidden');
        exit;
    }

    echo $flag;
}
?>
