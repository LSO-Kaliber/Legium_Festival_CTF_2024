<?php
require 'vendor/autoload.php';
use \Firebase\JWT\JWT;
use \Firebase\JWT\Key;

$secretKey = 'annisaaulia';

if (isset($_COOKIE['jwt'])) {
    $jwt = $_COOKIE['jwt'];

    if ($jwt) {
        try {
            $decoded = JWT::decode($jwt, new Key($secretKey, 'HS256'));
            if ($decoded->role === 'admin') {
                echo json_encode([
                    'status' => 'success',
                    'data' => 'Access granted to admin resource this is ur flag ((  LEST2024{H0n3stly-Im1s5-1T-3ut-1H4T3-1t}  ))',
                    'user' => $decoded->username
                ]);
            } else {
                echo json_encode([
                    'status' => 'error',
                    'message' => 'Access denied. Insufficient permissions.'
                ]);
            }
        } catch (Exception $e) {
            echo json_encode([
                'status' => 'error',
                'message' => 'Access denied. Invalid token.'
            ]);
        }
    } else {
        echo json_encode([
            'status' => 'error',
            'message' => 'Access denied. No token provided.'
        ]);
    }
} else {
    echo json_encode([
        'status' => 'error',
        'message' => 'Access denied. No token provided.'
    ]);
}
